---
title: "Биостатистика. ДЗ6. Некрасова Е.В."
output: html_document
date: "2024-04-17"
---
# Домашнее задание 6
Тема: расчет выборки при планировании исследования.
Цель: научиться рассчитывать выборку для исследований с различными конечными точками.
Описание ДЗ
При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.
Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

## Уровень значимости
```{r}
alpha <- 0.05
```

## Мощность
```{r}
power <- 0.80
```

## Ожидаемый drop-out rate
```{r}
dropout_rate <- 0.10
```

# 1. Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% (sigma = 0.20), а разница средних составляет −10% (epsilon). Клиницисты сообщают нам, что клинически значимая разница составляет 25% (delta = 0.25).

## Дисперсия
```{r}
sigma <- 0.20
```

## Разница средних
```{r}
epsilon <- -0.10
```

## Клинически значимая разница
```{r}
delta <- 0.25
```

## Рассчитываем z-значение для уровня значимости и мощности
```{r}
z_alpha_2 <- qnorm(1 - alpha/2)
z_beta <- qnorm(power)
```

## Рассчитываем размер выборки для каждой группы (n1 = n2) 
```{r}
n <- ((z_alpha_2 + z_beta)^2 * sigma^2) / (2 * (delta - abs(epsilon))^2)
```

## Размер выборки для каждой группы (учитываем drop-out rate)
```{r}
n <- n / (1 - dropout_rate)
n <- ceiling(n)
```

## Общий размер выборки (учитывая оба периода)
```{r}
n_total <- n * 2
```

## Выводим результаты
```{r}
cat("Выборка для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна:\n")
cat("Размер выборки для каждой группы (n1 = n2):", n, "\n")
cat("Общий размер выборки (учитывая оба периода):", n_total, "\n")
```
# 2. Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница  δ = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата p2  = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет p1  = 0.85. Соотношение групп равно k  = 1.

## Клинически значимая разница
```{r}
delta <- -0.1
```

## Доля ответов для тестового препарата
```{r}
p2 <- 0.65
```

## Доля ответов для препарата сравнения
```{r}
p1 <- 0.85
```

## Соотношение групп
```{r}
k <- 1
```

## Рассчитываем z-значение для уровня значимости и мощности
```{r}
z_alpha_2 <- qnorm(1 - alpha/2)
z_beta <- qnorm(power)
```

## Рассчитываем размер выборки для каждой группы (n1 = n2)
```{r}
n <- ((((z_alpha_2 + z_beta)^2) * (p1 * (1 - p1) + p2 * (1 - p2))) / (p1 - p2 - delta)^2) * k
```

## Размер выборки для каждой группы (учитываем drop-out rate)
```{r}
n <- n / (1 - dropout_rate)
n <- ceiling(n)
```

## Общий размер выборки (учитывая оба периода)
```{r}
n_total <- n * 2
```

## Выводим результаты
```{r}
cat("Выборка для гипотезы non-inferiority для двухвыборочного параллельного дизайна:\n")
cat("Размер выборки для каждой группы (n1 = n2):", n, "\n")
cat("Общий размер выборки (учитывая оба периода):", n_total, "\n")
```

# 2. Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1=p2=0.5).

## Отношение рисков (hazard ratio)
```{r}
HR <- 2
```

## Доля пациентов, подверженных заболеванию
```{r}
d <- 0.8
```

## Соотношение групп
```{r}
p1 <- 0.5
p2 <- 0.5
```

## Рассчитываем z-значение для уровня значимости и мощности
```{r}
z_alpha_2 <- qnorm(1 - alpha/2)
z_beta <- qnorm(power)
```

## Рассчитываем размер выборки для каждой группы (n1 = n2)
```{r}
n <- ((z_alpha_2 + z_beta)^2) / ((log(HR)^2) * p1 * p2 * d)
```

## Размер выборки для каждой группы (учитываем drop-out rate)
```{r}
n <- n / (1 - dropout_rate)
n <- ceiling(n)
```

## Общий размер выборки (учитывая оба периода)
```{r}
n_total <- n * 2
```

## Выводим результаты
```{r}
cat("Выборка для гипотезы equality для исследования с регрессией Кокса:\n")
cat("Размер выборки для каждой группы (n1 = n2):", n, "\n")
cat("Общий размер выборки (учитывая оба периода):", n_total, "\n")
```

