---
title: "Биостатистика. ДЗ4. Некрасова Е.В."
output: html_document
date: "2024-04-03"
---
# Загружаем библиотеки
```{r}
library(tidyverse)
library(ggplot2)
library(multcomp)
library(matrixStats)
```

# Задание 1
Рассмотрим следующую статистическую гипотезу.
Проводит некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

## Задаем seed для воспроизводимости результатов
```{r}
set.seed(123)
```

## Задаем размер выборки
```{r}
sample_size <- 30
```

## Задаем значение среднего артериального давления до приема нового препарата.
### Задаем параметры распределения (среднее и стандартное отклонение)
```{r}
mean_pressure_before <- 149.9  # Среднее давление
std_dev_pressure_before <- 5.1  # Стандартное отклонение давления
```

### Генерируем выборку среднего артериального давления до приема нового препарата
```{r}
pressure_before_medication <- rnorm(sample_size, mean_pressure_before, std_dev_pressure_before)
```

### Выводим первые 10 значений выборки
```{r}
print(head(pressure_before_medication, 10))
```
## Задаем значение среднего артериального давления после приема нового препарата и после.
### Задаем параметры распределения (среднее и стандартное отклонение)
```{r}
mean_pressure_after <- 130.2  # Среднее давление
std_dev_pressure_after <- 4.5  # Стандартное отклонение
```

### Генерируем выборку среднего артериального давления после приема нового препарата
```{r}
pressure_after_medication <- rnorm(sample_size, mean_pressure_after, std_dev_pressure_after)
```

### Выводим первые 10 значений выборки
```{r}
print(head(pressure_after_medication, 10))
```
## Формулируем нулевую и альтернативную гипотезы.
Нулевая гипотеза: Среднее артериальное давление до приема препарата равно среднему артериальному давлению после приема препарата
Альтернативная гипотеза: Среднее артериальное давление до приема препарата больше среднего артериального давления после приема препарата

## Определение уровень значимости
Уровень значимости будет определен как общепринятый уровень 0.05.
```{r}
alpha <- 0.05
```

## Выбираем статистический тест
Мы можем использовать одновыборочный t-тест, так как мы сравниваем средние значения одной группы до и после вмешательства.Также предполагается, что данные распределены нормально.
Кроме того, размер выборки небольшой (меньше 30), что также подходит для использования t-теста. Поэтому мы будем использовать t-тест для проверки гипотезы.

## Определяем наблюдаемое значение статистики
```{r}
observed_statistic <- (mean_pressure_before - mean_pressure_after) / (sd(pressure_before_medication) / sqrt(sample_size))
```
## Определяем критическое значение статистики
```{r}
critical_value <- qt(1 - alpha, df = sample_size - 1)
```

## Оценка статистической значимости
```{r}
if (observed_statistic > critical_value) {
  print("Отвергаем нулевую гипотезу")
} else {
  print("Не отвергаем нулевую гипотезу")
}
```
### Проведенный t-тест для сравнения среднего артериального давления до и после приема нового препарата показал, что значение статистики t превышает критическое значение. Это означает, что мы отвергаем нулевую гипотезу о равенстве средних значений до и после лечения. Результат теста указывает на статистическую значимость эффекта лечения на уровне значимости 0.05. Таким образом, среднее артериальное давление пациентов после приема нового препарата оказалось меньше, чем до его приема.

# Задание 2
Рассмотрим следующую статистическую гипотезу.
Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2
Рассмотрим два случая: для выборки sample_size1 <- 100 и выборки sample_size2 <- 30. Сгенерируем данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

##Для sample_size1 <- 100:
### Задание параметров
```{r}
prob_smoker <- 0.8  # Вероятность заболеть раком легких у курящих
prob_non_smoker <- 0.2  # Вероятность заболеть раком легких у некурящих
sample_size1 <- 100  # Размер первой выборки
```

### Генерация данных по курению
```{r}
smoking_status <- rep(c("Smoker", "Non-Smoker"), each = sample_size1 / 2)
lung_cancer <- ifelse(smoking_status == "Smoker", rbinom(sample_size1 / 2, 1, 0.8), rbinom(sample_size1 / 2, 1, 0.2))
```

### Формулировка гипотез
Нулевая гипотеза: Между курением и развитием рака легких нет связи
Альтернативная гипотеза: Существует связь между курением и развитием рака легких

### Уровень значимости
Уровень значимости будет определен как общепринятый уровень 0.05.
```{r}
alpha <- 0.05
```
### Выбор статистического теста
Для проверки гипотезы о связи между двумя категориальными переменными (курение и развитие рака легких) мы используем тест хи-квадрат, так как он подходит для анализа таблиц сопряженности.

### Определение наблюдаемого значения статистики
```{r}
observed_statistic <- chisq.test(table(smoking_status,lung_cancer))$statistic
```

### Определение критического значения статистики
```{r}
critical_value <- qchisq(1 - alpha, df = 1)
```

### Оценка статистической значимости
```{r}
if (observed_statistic > critical_value) {
  print("Отвергаем нулевую гипотезу")
} else {
  print("Не отвергаем нулевую гипотезу")
}
```

## Для sample_size2 <- 30:
### Задание параметров
```{r}
sample_size2 <- 30  # Размер второй выборки
```

### Генерация данных по курению
```{r}
smoking_status <- rep(c("Smoker", "Non-Smoker"), each = sample_size2 / 2)
lung_cancer <- ifelse(smoking_status == "Smoker", rbinom(sample_size2 / 2, 1, 0.8), rbinom(sample_size2 / 2, 1, 0.2))
```
### Формулировка гипотез
Нулевая гипотеза: Между курением и развитием рака легких нет связи
Альтернативная гипотеза: Существует связь между курением и развитием рака легких

### Уровень значимости
Уровень значимости будет определен как общепринятый уровень 0.05.
```{r}
alpha <- 0.05
```
### Выбор статистического теста
Также используем тест хи-квадрат для анализа таблиц сопряженности.

### Определение наблюдаемого значения статистики
```{r}
observed_statistic <- chisq.test(table(smoking_status,lung_cancer))$statistic
```

### Определение критического значения статистики
```{r}
critical_value <- qchisq(1 - alpha, df = 1)
```

### Оценка статистической значимости
```{r}
if (observed_statistic > critical_value) {
  print("Отвергаем нулевую гипотезу")
} else {
  print("Не отвергаем нулевую гипотезу")
}
```
### Результаты теста хи-квадрат на независимость показывают, что значение p-value ниже 0.05. Это означает, что мы можем уверенно отвергнуть нулевую гипотезу о независимости между курением и развитием рака легких. Таким образом, на основании этих результатов можно сделать вывод о существовании статистически значимой связи между курением и развитием рака легких в рассматриваемых выборках.

# Задание 3
Рассмотрите следующую статистическую гипотезу.
Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.
Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.

## Генерация данных
```{r}
group1 <- c(3, 4, 5, 4, 3, 4, 2, 3, 5, 3)  # Группа с диетотерапией
group2 <- c(2, 1, 2, 1, 3, 2, 1, 2, 2, 1)  # Группа с новым методом лечения
```

## Формулировка гипотез
Нулевая гипотеза (H0): Применение нового метода лечения синдрома раздраженного кишечника не влияет на уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.
Альтернативная гипотеза (H1): Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией
```{r}
H0 <- "Применение нового метода лечения не влияет на уровень болевых симптомов"
H1 <- "Применение нового метода лечения значимо меняет уровень болевых симптомов"
```

## Уровень значимости
Уровень значимости будет определен как общепринятый уровень 0.05.
```{r}
alpha <- 0.05
```

## Проведение теста Манна-Уитни
Для проверки гипотезы мы будем использовать тест Манна-Уитни, который является непараметрическим аналогом t-теста для независимых выборок и подходит для сравнения двух независимых групп, не требуя нормального распределения данных.
```{r}
result <- wilcox.test(group1, group2)
```

## Вывод результатов
```{r}
if (result$p.value < alpha) {
  print("Отвергаем нулевую гипотезу")
  print(H1)
} else {
  print("Не отвергаем нулевую гипотезу")
  print(H0)
}
```
## Вывод наблюдаемого значения статистики
```{r}
print("Наблюдаемое значение статистики:")
print(result$statistic)
```
## Вывод критического значения статистики
```{r}
print("Критическое значение статистики: в данном случае не применимо")
```
## Вывод статистической значимости
```{r}
if (result$p.value < alpha) {
  print("Статистически значимая разница между группами")
} else {
  print("Нет статистически значимой разницы между группами")
}
```

## Уровень значимости p-value значительно меньше стандартного уровня значимости 0.05. Это говорит о том, что различия в уровнях боли между двумя группами являются статистически значимыми. Значение критерия также показывает, что средние значения уровней боли существенно различаются между двумя группами. Исходя из этих результатов, можно сделать вывод о статистически значимом различии между уровнями боли в двух группах. Таким образом, применение нового метода лечения синдрома раздраженного кишечника оказывает существенное влияние на уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

# Задание 4.
Рассмотрим следующую гипотезу.
Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.

## Генерируем датасет
```{r}
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)
```

## Задаем seed для воспроизводимости результатов
```{r}
set.seed(123) 
tumor$value <- tumor$value + rnorm(30, 0, 760)
```

## Построим на одном графике три “ящика с усами” для наглядности
```{r}
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  labs(title = "Размер опухоли по различным противоопухолевым препаратам и плацебо",
       x = "Терапия",
       y = "Размер опухоли") +
  theme_minimal()
```
# Проведем дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах
```{r}
anova_result <- aov(value ~ therapy, data = tumor)
```

# Выведем результаты
```{r}
summary(anova_result)
```

Результаты дисперсионного анализа показывают, что есть статистически значимая разница в размере опухоли между группами (F(2, 27) = 4.686, p = 0.0179). Это означает, что выбранные методы лечения имеют различное воздействие на размер опухоли.После этого мы можем провести попарные сравнения с помощью критерия Тьюки, чтобы выяснить, между какими конкретно группами есть статистически значимые различия в размере опухоли.

# Проведем попарные сравнения с помощью критерия Тьюки
```{r}
tukey_result <- TukeyHSD(anova_result)
```

# Выведем результаты
```{r}
print(tukey_result)
```

Результаты попарных сравнений с помощью критерия Тьюки позволяют нам выявить статистически значимые различия в размере опухоли между некоторыми парами групп:
Между группами, получившими препарат A и плацебо (0), нет статистически значимой разницы в размере опухоли (p = 0.2394).
Между группами, получившими препарат B и плацебо (0), наблюдается статистически значимая разница в размере опухоли (p = 0.0134). Это указывает на то, что препарат B значительно влияет на размер опухоли по сравнению с плацебо.
Между группами, получившими препарат B и A, нет статистически значимой разницы в размере опухоли (p = 0.3553).
Таким образом, результаты показывают, что препарат B имеет статистически значимый эффект на размер опухоли по сравнению с плацебо, в то время как препарат A не оказывает значимого влияния. Кроме того, между препаратами A и B также не наблюдается статистически значимых различий.




